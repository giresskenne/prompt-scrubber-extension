(()=>{"use strict";(()=>{const e=[{id:"aws_access_key",pattern:new RegExp("(?<![A-Z0-9])[A-Z0-9]{20}(?![A-Z0-9])","g"),replacer:()=>"AKIA****************"},{id:"aws_secret_key",pattern:new RegExp("(?<![A-Za-z0-9\\/+=])[A-Za-z0-9\\/+=]{40}(?![A-Za-z0-9\\/+=])","g"),replacer:()=>"<AWS_SECRET_KEY-REDACTED>"},{id:"stripe_secret",pattern:new RegExp("(sk_live|sk_test)_[0-9a-zA-Z]{24}","g"),replacer:(e,...t)=>"$1_********************".replace("$&",e).replace(/\$(\d)/g,((e,n)=>t[n-1]||""))},{id:"credit_card",pattern:new RegExp("\\b(?:4[0-9]{12}(?:[0-9]{3})?|5[1-5][0-9]{14}|3[47][0-9]{13}|6(?:011|5[0-9]{2})[0-9]{12})\\b","g"),replacer:()=>"<CREDIT_CARD-REDACTED>"},{id:"email",pattern:new RegExp("[A-Z0-9._%+-]+@[A-Z0-9.-]+\\.[A-Z]{2,}","i"),replacer:()=>"<EMAIL-REDACTED>"},{id:"ipv4",pattern:new RegExp("\\b(?:(?:2(?:5[0-5]|[0-4][0-9])|1?[0-9]{1,2})\\.){3}(?:2(?:5[0-5]|[0-4][0-9])|1?[0-9]{1,2})\\b","g"),replacer:()=>"<IPV4-REDACTED>"},{id:"canadian_sin",pattern:new RegExp("\\b[0-9]{3}[- ]?[0-9]{3}[- ]?[0-9]{3}\\b","g"),replacer:()=>"<CANADIAN_SIN-REDACTED>"},{id:"us_social_security_number",pattern:new RegExp("\\b\\d{3}-?\\d{2}-?\\d{4}\\b","g"),replacer:()=>"<US_SOCIAL_SECURITY_NUMBER-REDACTED>"},{id:"us_phone_number",pattern:new RegExp("\\b\\(?\\d{3}\\)?[-. ]?\\d{3}[-. ]?\\d{4}\\b","g"),replacer:()=>"<US_PHONE_NUMBER-REDACTED>"},{id:"uk_national_insurance_number",pattern:new RegExp("\\b[A-Z]{2}[0-9]{6}[A-Z]?\\b","g"),replacer:()=>"<UK_NATIONAL_INSURANCE_NUMBER-REDACTED>"},{id:"uk_passport_number",pattern:new RegExp("\\b[A-PR-WY][0-9]{7}\\b","g"),replacer:()=>"<UK_PASSPORT_NUMBER-REDACTED>"},{id:"uk_nhs_number",pattern:new RegExp("\\b[0-9]{3} [0-9]{3} [0-9]{3}\\b","g"),replacer:()=>"<UK_NHS_NUMBER-REDACTED>"},{id:"uk_driving_license_number",pattern:new RegExp("\\b[A-Z]{2}[0-9]{6}[A-Z]?\\b","g"),replacer:()=>"<UK_DRIVING_LICENSE_NUMBER-REDACTED>"},{id:"uk_bank_account_number",pattern:new RegExp("\\b[0-9]{8}\\b","g"),replacer:()=>"<UK_BANK_ACCOUNT_NUMBER-REDACTED>"}];"undefined"!=typeof window&&(window.PromptScrubberRedactor={redact:function(t){let n=t,r=Object.create(null);for(const t of e){const e=n;n=n.replace(t.pattern,t.replacer),e!==n&&(r[t.id]=(r[t.id]||0)+1)}return{clean:n,stats:r}},rules:e})})(),function(){let e=!1;chrome.runtime.sendMessage({type:"ping"},(t=>{t?.ready&&(e=!0)})),function(){if(document.getElementById("psHighlightStyles"))return;const e=document.createElement("style");e.id="psHighlightStyles",e.textContent="\n      .ps-wrapper{position:relative;}\n      .ps-overlay{\n        position:absolute;top:0;left:0;width:100%;height:100%;\n        pointer-events:none;z-index:3;\n        white-space:pre-wrap;word-break:break-word;\n        font:inherit;line-height:inherit;padding:inherit;\n        color:transparent;               /* hide duplicate glyphs */\n      }\n      .ps-hl{\n        color:inherit;\n        text-decoration:underline wavy #ff4d6a;\n      }\n    ",document.head.appendChild(e)}();const t=new ResizeObserver((e=>{for(const{target:t}of e){const e=t._highlightOverlay;e&&(e.style.width=t.clientWidth+"px",e.style.height=t.clientHeight+"px")}}));function n(e){e._highlightOverlay&&(e._highlightOverlay.remove(),delete e._highlightOverlay,e.removeEventListener("scroll",a))}const r=e=>e.replace(/[&<>"']/g,(e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[e]))),i=new RegExp(["\\bAKIA[0-9A-Z]{12,20}\\b","\\b(?:sk|gh[pous]|gitpat)[-_][A-Za-z0-9]{20,}\\b","[A-Za-z0-9._%+-]+@[^\\s@]+\\.[A-Za-z]{2,}","\\b(?:\\d{1,3}\\.){3}\\d{1,3}\\b","\\b(?:\\d{4}[-\\s]?){3}\\d{4}\\b","\\bsk_(?:live|test)?_[A-Za-z0-9]{24,}\\b"].join("|"),"gi");function a(e){const t=e.target;t._highlightOverlay&&(t._highlightOverlay.scrollTop=t.scrollTop)}const o=(()=>{let e=0;return(n,a=null)=>{"TEXTAREA"!==n.tagName&&(e&&cancelAnimationFrame(e),e=requestAnimationFrame((()=>{const e=function(e){if("TEXTAREA"===e.tagName)return null;const n=function(e){if(e.parentNode?.classList?.contains("ps-wrapper"))return e.parentNode;const t=document.createElement("div");return t.className="ps-wrapper",t.style.position="relative",e.parentNode.insertBefore(t,e),t.appendChild(e),t}(e);let r=n.querySelector(".ps-overlay");return r||(r=document.createElement("div"),r.className="ps-overlay",n.appendChild(r),function(e,t){const n=getComputedStyle(e);["font","fontFamily","fontSize","fontWeight","lineHeight","letterSpacing","wordSpacing","whiteSpace","wordBreak","tabSize","paddingTop","paddingRight","paddingBottom","paddingLeft","textIndent"].forEach((e=>t.style[e]=n[e]))}(e,r),t.observe(e),e._highlightOverlay=r),r}(n);if(!e)return;const o=n.innerText||"";if(!o.trim())return void(e.innerHTML="");let s=a;if(!s){let e;for(s=[],i.lastIndex=0;e=i.exec(o);)s.push({start:e.index,end:e.index+e[0].length})}if(!s.length)return void(e.innerHTML="");let l="",c=0;s.sort(((e,t)=>e.start-t.start));for(const e of s)l+=r(o.slice(c,e.start)),l+=`<span class="ps-hl">${r(o.slice(e.start,e.end))}</span>`,c=e.end;l+=r(o.slice(c)),e.innerHTML=l})))}})();let s=null;function l(e){const t="TEXTAREA"===e.tagName?e.value:e.innerText,{clean:r,stats:i}=self.PromptScrubberRedactor.redact(t);"TEXTAREA"===e.tagName?(Object.getOwnPropertyDescriptor(HTMLTextAreaElement.prototype,"value").set.call(e,r),e.dispatchEvent(new Event("input",{bubbles:!0}))):e.innerText=r;const a=Object.values(i).reduce(((e,t)=>e+t),0);!function(e){const t=Object.assign(document.body.appendChild(document.createElement("div")),{textContent:e,style:"position:fixed;bottom:120px;right:24px;padding:8px 12px;background:#111;color:#fff;border-radius:6px;font-size:14px;z-index:9999;opacity:0;transition:opacity .3s;"});requestAnimationFrame((()=>t.style.opacity="0.9")),setTimeout((()=>{t.style.opacity="0",setTimeout((()=>t.remove()),300)}),2e3)}(a?`${a} sensitive items masked`:"No sensitive items detected"),console.groupCollapsed("%c[Scrubber] Redaction preview","color:#0a0"),console.table(i),console.groupEnd(),n(e)}document.addEventListener("input",(t=>{if(!function(e){return e&&("TEXTAREA"===e.tagName||e.isContentEditable||"textbox"===e.getAttribute("role"))}(t.target))return;const r=t.target,i="TEXTAREA"===r.tagName?r.value:r.innerText;if(i.trim()){var c;if(s=r,"TEXTAREA"!==r.tagName&&(o(r),e&&(c=i,new Promise((e=>{chrome.runtime.sendMessage({type:"scan",text:c},e)}))).then((e=>o(r,e))),r._scrollSynced||(r.addEventListener("scroll",a),r._scrollSynced=!0)),!document.getElementById("scrubSendBtn")){const e=document.createElement("button");e.id="scrubSendBtn",e.type="button",e.innerHTML=`\n          <img src="${chrome.runtime.getURL("icons/logo.png")}" alt="" width="16" height="16" style="vertical-align:middle;margin-right:4px"> Scrub`,Object.assign(e.style,{margin:"2px 8px",padding:"2px 8px 2px 6px",fontSize:"12px",border:"1px solid #d0d7de",borderRadius:"10px",background:"#fff",cursor:"pointer",transition:"background .15s",display:"inline-flex",alignItems:"center",gap:"4px"}),e.addEventListener("mouseover",(()=>e.style.background="#f6f8fa")),e.addEventListener("mouseout",(()=>e.style.background="#fff")),r.parentElement.insertBefore(e,r.nextSibling),e.addEventListener("click",(()=>l(r)))}}else{"TEXTAREA"!==r.tagName&&n(r);const e=document.getElementById("scrubSendBtn");e&&e.remove()}}),!0),document.addEventListener("keydown",(e=>{e.altKey&&e.shiftKey&&"s"===e.key.toLowerCase()&&s&&(e.preventDefault(),l(s))}),!0)}()})();