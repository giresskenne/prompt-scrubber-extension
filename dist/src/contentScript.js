(()=>{"use strict";(()=>{const e=[{id:"aws_access_key",pattern:new RegExp("(?<![A-Z0-9])[A-Z0-9]{20}(?![A-Z0-9])","g"),replacer:()=>"AKIA****************"},{id:"aws_secret_key",pattern:new RegExp("(?<![A-Za-z0-9\\/+=])[A-Za-z0-9\\/+=]{40}(?![A-Za-z0-9\\/+=])","g"),replacer:()=>"<AWS_SECRET_KEY-REDACTED>"},{id:"stripe_secret",pattern:new RegExp("(?:sk[-_](?:live|test)[-_]?[A-Za-z0-9]{20,})","g"),replacer:()=>"sk_********************"},{id:"credit_card",pattern:new RegExp("\\b(?:4\\d{3}(?:[- ]?\\d{4}){3}|(?:5[1-5]\\d{2}|22[2-9]\\d|2[3-6]\\d{2}|27[01]\\d|2720)(?:[- ]?\\d{4}){3}|3[47]\\d{2}[- ]?\\d{6}[- ]?\\d{5}|6(?:011|5\\d{2})(?:[- ]?\\d{4}){3})\\b","g"),replacer:()=>"<CREDIT_CARD-REDACTED>"},{id:"email",pattern:new RegExp("[A-Z0-9._%+-]+@[A-Z0-9.-]+\\.[A-Z]{2,}","i"),replacer:()=>"<EMAIL-REDACTED>"},{id:"ipv4",pattern:new RegExp("\\b(?:(?:2(?:5[0-5]|[0-4][0-9])|1?[0-9]{1,2})\\.){3}(?:2(?:5[0-5]|[0-4][0-9])|1?[0-9]{1,2})\\b","g"),replacer:()=>"<IPV4-REDACTED>"},{id:"canadian_sin",pattern:new RegExp("\\b[0-9]{3}[- ]?[0-9]{3}[- ]?[0-9]{3}\\b","g"),replacer:()=>"<CANADIAN_SIN-REDACTED>"},{id:"us_social_security_number",pattern:new RegExp("\\b\\d{3}-?\\d{2}-?\\d{4}\\b","g"),replacer:()=>"<US_SOCIAL_SECURITY_NUMBER-REDACTED>"},{id:"us_phone_number",pattern:new RegExp("\\b\\(?\\d{3}\\)?[-. ]?\\d{3}[-. ]?\\d{4}\\b","g"),replacer:()=>"<US_PHONE_NUMBER-REDACTED>"},{id:"uk_national_insurance_number",pattern:new RegExp("\\b[A-Z]{2}[0-9]{6}[A-Z]?\\b","g"),replacer:()=>"<UK_NATIONAL_INSURANCE_NUMBER-REDACTED>"},{id:"uk_passport_number",pattern:new RegExp("\\b[A-PR-WY][0-9]{7}\\b","g"),replacer:()=>"<UK_PASSPORT_NUMBER-REDACTED>"},{id:"uk_nhs_number",pattern:new RegExp("\\b[0-9]{3} [0-9]{3} [0-9]{3}\\b","g"),replacer:()=>"<UK_NHS_NUMBER-REDACTED>"},{id:"uk_driving_license_number",pattern:new RegExp("\\b[A-Z]{2}[0-9]{6}[A-Z]?\\b","g"),replacer:()=>"<UK_DRIVING_LICENSE_NUMBER-REDACTED>"},{id:"uk_bank_account_number",pattern:new RegExp("\\b[0-9]{8}\\b","g"),replacer:()=>"<UK_BANK_ACCOUNT_NUMBER-REDACTED>"},{id:"password_(key=value)",pattern:new RegExp("(?:password|passwd|pwd|pass)\\s*=\\s*[^\\s,;]+","i"),replacer:()=>"<PASSWORD_(KEY=VALUE)-REDACTED>"},{id:"cvv",pattern:new RegExp("\\bcvv\\s*=\\s*\\d{3,4}\\b","i"),replacer:()=>"<CVV-REDACTED>"},{id:"card_expiry",pattern:new RegExp("\\bexpiry\\s*=\\s*(0[1-9]|1[0-2])/(\\d{2}|\\d{4})\\b","i"),replacer:()=>"<CARD_EXPIRY-REDACTED>"},{id:"currency_amount",pattern:new RegExp("\\$\\d{1,3}(?:,\\d{3})*(?:\\.\\d{2})?","g"),replacer:()=>"<CURRENCY_AMOUNT-REDACTED>"},{id:"jdbc_url_with_credentials",pattern:new RegExp("jdbc:[^?\\s]+\\?[^\\s]*(?:user|username|uid)=[^&\\s]+&(?:password|pwd)=[^&\\s]+","i"),replacer:()=>"<JDBC_URL_WITH_CREDENTIALS-REDACTED>"},{id:"generic_secret_/_api_token",pattern:new RegExp("(?:api[_-]?key|secret|token|access[_-]?key)\\s*=\\s*[^\\s,;]+","i"),replacer:()=>"<GENERIC_SECRET_/_API_TOKEN-REDACTED>"},{id:"jwt",pattern:new RegExp("ey[A-Za-z0-9_-]{10,}\\.[A-Za-z0-9._-]{10,}\\.[A-Za-z0-9._-]{10,}","g"),replacer:()=>"<JWT-REDACTED>"}];"undefined"!=typeof window&&(window.PromptScrubberRedactor={redact:function(t){let n=t,r=Object.create(null);for(const t of e){const e=n;n=n.replace(t.pattern,t.replacer),e!==n&&(r[t.id]=(r[t.id]||0)+1)}return{clean:n,stats:r}},rules:e})})(),(()=>{function e(e){return"TEXTAREA"===e.tagName?e.value:e.innerText}let t=null,n=new Map,r=!0;function a(e){const r=e.parentElement?.querySelector("#scrubSendBtn")?.parentElement;r&&r.remove(),n.delete(e),t=null}chrome.storage&&chrome.storage.sync.get("enabled",(e=>{r=!e.hasOwnProperty("enabled")||e.enabled})),chrome.runtime&&chrome.runtime.onMessage&&chrome.runtime.onMessage.addListener(((e,t,n)=>{e&&"setState"===e.action&&"boolean"==typeof e.enabled&&(r=e.enabled)})),document.addEventListener("input",(i=>{if(!r)return;if(!(e=>e&&("TEXTAREA"===e.tagName||e.isContentEditable||"textbox"===e.getAttribute("role")))(i.target))return;const s=i.target;e(s).trim()?(t=s,function(t){if(t.parentElement.querySelector("#scrubSendBtn"))return;const r=document.createElement("div");r.style.cssText="display:inline-flex;gap:4px;margin:2px 8px;";const i=document.createElement("button");i.id="scrubSendBtn",i.type="button",i.innerHTML=`<img src="${chrome.runtime.getURL("icons/logo.png")}" width="16" height="16" style="vertical-align:middle;margin-right:4px"> Scrub`,Object.assign(i.style,{padding:"2px 8px 2px 6px",fontSize:"12px",border:"1px solid #d0d7de",borderRadius:"10px",background:"#fff",cursor:"pointer",display:"inline-flex",alignItems:"center",gap:"4px"}),i.onclick=()=>function(t){n.get(t)&&(removeUnderlines(t),n.set(t,!1),updateUnderlineButton(t,!1));let r=e(t),i=0;for(let e=0;e<10;e++){const{clean:e,stats:t}=self.PromptScrubberRedactor.redact(r),n=Object.values(t).reduce(((e,t)=>e+t),0);if(i+=n,r=e,0===n)break}(function(e,t){"TEXTAREA"===e.tagName?(Object.getOwnPropertyDescriptor(HTMLTextAreaElement.prototype,"value").set.call(e,t),e.dispatchEvent(new Event("input",{bubbles:!0}))):e.innerText=t})(t,r),function(e){const t=Object.assign(document.body.appendChild(document.createElement("div")),{textContent:e,style:"position:fixed;bottom:120px;right:24px;padding:8px 12px;background:#111;color:#fff;border-radius:6px;font:14px/1 sans-serif;z-index:9999;opacity:0;transition:opacity .3s;"});requestAnimationFrame((()=>t.style.opacity="0.9")),setTimeout((()=>{t.style.opacity="0",setTimeout((()=>t.remove()),300)}),2500)}(i?`${i} sensitive item${i>1?"s":""} masked`:"No sensitive items detected"),r.trim()||a(t)}(t),r.appendChild(i),t.parentElement.insertBefore(r,t.nextSibling)}(s),function(t){if("TEXTAREA"===t.tagName){const n=e(t);if(!n.trim())return t.style.background="",void t.removeAttribute("data-sensitive-count");const{stats:r}=self.PromptScrubberRedactor.redact(n),a=Object.values(r).reduce(((e,t)=>e+t),0);a>0?(t.style.background="linear-gradient(90deg, #fff 0%, #ffebee 100%)",t.setAttribute("data-sensitive-count",a)):(t.style.background="",t.removeAttribute("data-sensitive-count"))}}(s)):a(s)}),!0)})()})();